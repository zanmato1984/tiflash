# Work in Progress

# (none)

# To Do

# (none)

# Completed
- TiForth core + TiFlash guarded integration (MS1-6, common path): Arrow-native pipeline/task framework + operators (pass-through/projection/filter/hash agg/hash join/sort) with Block<->Arrow bridge + TiFlash translation/block-runner gtests under `TIFLASH_ENABLE_TIFORTH`.
- Semantics parity + type contract (MS8 + follow-ups): TiDB collations (binary/padding/general_ci/unicode_ci 0400/0900) with vectorized compare + hash normalization + sort-key generation; decimal add parity; packed MyTime temporal scalars; Arrow field metadata as logical-type side channel.
- Host surface + perf (MS7/MS10 + follow-ups): Arrow compute registry integration + expr compilation to bound `Expression`/`ExecuteScalarExpression` (and public `tiforth::CompiledExpr`); `tiforth_capi` C ABI using Arrow C Data/Stream interfaces; memory pool propagation across operators; follow-up To Do list derived via objective review.
- Docs reconciliation: update design docs + C ABI header comments to match current implementation (MS7/MS9/MS10) and refresh main design doc header/milestone wording. Files: `docs/design/2026-01-14-tiforth.md`, `docs/design/2026-01-14-tiforth-milestone-{7,9,10}-*.md`, `libs/tiforth/include/tiforth_c/tiforth.h`. Builds: `ninja -C libs/tiforth/build-debug && ctest`.
- API packaging: exclude internal-only `tiforth/detail/{arrow_compute,expr_compiler}.h` from `cmake --install`, keep only public-dependency `tidb_collation_lut.h`; add `libs/tiforth/scripts/verify_install.sh` to validate install tree + `find_package(tiforth)` consumer compile. Files: `libs/tiforth/CMakeLists.txt`, `libs/tiforth/scripts/verify_install.sh`. Checks: `bash libs/tiforth/scripts/verify_install.sh libs/tiforth/build-debug`, `ninja -C libs/tiforth/build-debug && ctest`.
- Shared helpers: move duplicated Datum->Array conversion logic into `tiforth::detail::DatumToArray` (handles array/chunked/scalar) and reuse it across filter/sort/hash_join/compiled expr/expr compiler. Files: `libs/tiforth/include/tiforth/detail/arrow_compute.h`, `libs/tiforth/src/tiforth/detail/arrow_compute.cc`, `libs/tiforth/src/tiforth/{compiled_expr,detail/expr_compiler,operators/{filter,hash_join,sort}}.cc`. Builds: `ninja -C libs/tiforth/build-debug && ctest`, `ninja -C cmake-build-tiflash-tiforth-debug gtests_dbms && gtests_dbms --gtest_filter=TiForth*`.
- Memory accounting gaps (normalized string keys): use `std::pmr::string` backed by an Arrow `MemoryPool` adapter for collated sort-key precompute and hash join/agg key normalization; add a ProxyMemoryPool regression test for collated sort; fix `HashJoinTransformOp` member destruction order so pmr resource outlives the hash index. Files: `libs/tiforth/include/tiforth/collation.h`, `libs/tiforth/include/tiforth/operators/hash_join.h`, `libs/tiforth/src/tiforth/operators/hash_join.cc`, `libs/tiforth/include/tiforth/operators/hash_agg.h`, `libs/tiforth/src/tiforth/operators/hash_agg.cc`, `libs/tiforth/src/tiforth/operators/sort.cc`, `libs/tiforth/tests/tiforth_memory_pool_test.cpp`. Checks: `ninja -C libs/tiforth/build-debug && ctest`, `bash libs/tiforth/scripts/verify_install.sh libs/tiforth/build-debug`, `ninja -C cmake-build-tiflash-tiforth-debug gtests_dbms && cmake-build-tiflash-tiforth-debug/dbms/gtests_dbms --gtest_filter=TiForth*`.
