# Work in Progress
- (none)

# To Do
- MS4: write milestone design doc (Filter + expression evaluation + differential tests plan).
- MS4: implement Filter + expression evaluation; expand tests with equivalence checks.

# Completed
- MS3: implement Expr IR + Projection operator: add `Expr` (`FieldRef`/`Literal`/`Call`) with `EvalExpr*` via Arrow compute (`CallFunction` + scalar broadcast; lazy `arrow::compute::Initialize()`; chunked-array concat); add `ProjectionTransformOp`; export headers via `tiforth/tiforth.h`; add `tiforth_projection_test` and update `witharrow` example. Validation: `ninja -C libs/tiforth/build-debug` + `ctest --test-dir libs/tiforth/build-debug`; `ninja -C cmake-build-tiflash-tiforth-debug gtests_dbms` + `gtests_dbms --gtest_filter=TiForthPipelineTranslateTest.*` OK. Files: docs/design/2026-01-14-tiforth-milestone-3-projection-scalar-functions.md, libs/tiforth/include/tiforth/{expr.h,tiforth.h,operators/projection.h}, libs/tiforth/src/tiforth/{expr.cc,CMakeLists.txt,operators/projection.cc}, libs/tiforth/tests/{CMakeLists.txt,tiforth_projection_test.cpp}, libs/tiforth/examples/src/witharrow_main.cc, .codex/progress/daemon.md.
- MS3 design: Projection + minimal scalar functions milestone doc added (expression IR + Arrow compute eval plan + ProjectionTransformOp steps). Files: docs/design/2026-01-14-tiforth-milestone-3-projection-scalar-functions.md, .codex/progress/daemon.md.
- MS3 (pipeline framework port): add TiFlash-shaped pipeline exec framework in TiForth (`Operator`/`SourceOp`/`TransformOp`/`SinkOp`, `PipelineExec` + builder) using Arrow `RecordBatch`; `PipelineBuilder` can append transform factories; `Task` runs `PipelineExec` with host-driven input/output; add exported `PassThroughTransformOp`. Add TiFlash gtest constructing a TiFlash `PipelineExecBuilder` DAG and translating into a TiForth pipeline using TiForth APIs only (guarded by `TIFLASH_ENABLE_TIFORTH`). Validation: `ctest --test-dir libs/tiforth/build-debug` OK; `ninja -C cmake-build-tiflash-tiforth-debug gtests_dbms` OK; `gtests_dbms --gtest_filter=TiForthPipelineTranslateTest.*` OK. Files: docs/design/2026-01-14-tiforth-milestone-3-pipeline-framework.md, libs/tiforth/include/tiforth/{operators.h,pipeline_exec.h,operators/pass_through.h,pipeline.h,task.h}, libs/tiforth/src/tiforth/{pipeline_exec.cc,pipeline.cc,task.cc,CMakeLists.txt}, dbms/src/Flash/tests/gtest_tiforth_pipeline_translate.cpp, .codex/progress/daemon.md.
- MS2 (hello pipeline): Task supports `PushInput`/`CloseInput`/`PullOutput` + optional `SetInputReader`; Pipeline supports `MakeReader` (reader→reader wrapper owning internal Task); pass-through operator (zero-copy batch forwarding); update TiForth tests/examples and TiFlash integration smoke. Validation: `cmake -S libs/tiforth -B libs/tiforth/build-debug -DTIFORTH_BUILD_TESTS=ON` + `ninja -C libs/tiforth/build-debug` + `ctest --test-dir libs/tiforth/build-debug`; `ninja -C cmake-build-tiflash-tiforth tiforth` OK. Files: docs/design/2026-01-14-tiforth-milestone-2-recordbatch-plumbing.md, libs/tiforth/include/tiforth/{task.h,pipeline.h}, libs/tiforth/src/tiforth/{task.cc,pipeline.cc}, libs/tiforth/tests/{CMakeLists.txt,tiforth_smoke_test.cpp,tiforth_pass_through_reader_test.cpp}, libs/tiforth/examples/src/{noarrow_main.cc,witharrow_main.cc}, dbms/src/Flash/tests/gtest_tiforth_integration.cpp, libs/tiforth/.gitignore.
- TiForth build + Arrow: always require ArrowCompute; parent Arrow target reuse now requires separate compute target and forbids `TIFORTH_BUILD_TESTS`; tests explicitly link ArrowTesting; package config always depends on ArrowCompute; simplify linkage validation. Files: libs/tiforth/CMakeLists.txt, libs/tiforth/cmake/find/arrow.cmake, libs/tiforth/cmake/find/gtest.cmake, libs/tiforth/cmake/testing/testing.cmake, libs/tiforth/cmake/tiforthConfig.cmake.in, libs/tiforth/src/tiforth/CMakeLists.txt
- TiFlash integration + Arrow removal: replace old `ENABLE_ARROW` plumbing with `ENABLE_TIFORTH`; stop assuming in-tree Arrow; remove Arrow submodule + NOTICE entry. Files: CMakeLists.txt, libs/CMakeLists.txt, dbms/CMakeLists.txt, dbms/src/Server/CMakeLists.txt, dbms/src/Flash/tests/gtest_tiforth_integration.cpp, contrib/CMakeLists.txt, NOTICE, .gitmodules; deleted: cmake/find_arrow.cmake, contrib/arrow, contrib/arrow-cmake/CMakeLists.txt
- Validation: `ctest --test-dir libs/tiforth/build-debug` OK; TiFlash configure OK; `ninja -C cmake-build-tiflash-tiforth tiforth` OK (used `-DFETCHCONTENT_SOURCE_DIR_ARROW=libs/tiforth/build-debug/_deps/arrow-src` after removing contrib/arrow). Notes: full TiFlash build may still be disk-heavy due to `tiflash-proxy`.
- TiForth: simplify googletest discovery for tests: bundled Arrow requires `gtest`/`gtest_main` targets and provides `GTest::gtest` aliases; system Arrow uses `find_package(GTest)`. Decision: no parent/outer gtest assumptions since tests are top-level only. Files: libs/tiforth/cmake/find/gtest.cmake
- Validation + ship: `cmake -S libs/tiforth -B libs/tiforth/build-debug -DTIFORTH_BUILD_TESTS=ON` + `ninja -C libs/tiforth/build-debug` + `ctest --test-dir libs/tiforth/build-debug` OK; commit. Files: .codex/progress/daemon.md
- TiForth examples: add consumer project matrix for Arrow usage/provider/linkage × TiForth provider/linkage (per-directory standalone CMake projects); provide local “system” Arrow/TiForth bootstrap (Arrow installed to local prefix; TiForth installed in 4 variants). Decision: exclude `arrow-bundled-*__tiforth-system-*` since `find_package(tiforth)` requires Arrow as a discoverable package (avoid multiple Arrow copies in one process). Validation: `ctest --test-dir libs/tiforth/build-debug` OK; configured `libs/tiforth/examples/projects/arrow-bundled-shared__tiforth-bundled-shared` using `-DFETCHCONTENT_SOURCE_DIR_ARROW=.../arrow-src`. Files: libs/tiforth/examples/README.md, libs/tiforth/examples/.gitignore, libs/tiforth/examples/src/noarrow_main.cc, libs/tiforth/examples/src/witharrow_main.cc, libs/tiforth/examples/projects/*/CMakeLists.txt, libs/tiforth/examples/deps/arrow/CMakeLists.txt, libs/tiforth/examples/scripts/bootstrap_local_system_deps.sh, .codex/progress/daemon.md
