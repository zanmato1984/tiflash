# Work in Progress

# To Do

# Completed
- MS8F: TiForth self-implemented scalar function framework + decimal/string semantics. Decisions: add `FunctionRegistry` + `TypedDatum` wrapper carrying logical type metadata; dispatch `Expr::Call` via registry with Arrow compute fallback; implement `add(decimal,decimal)` using TiFlash `PlusDecimalInferer` (prec/scale) and exact scale alignment; move collation-aware string comparisons (`equal/less/...`) into registry overrides; projection preserves input field metadata for field refs and emits decimal logical metadata for computed decimals. Files: `libs/tiforth/include/tiforth/{engine,expr,function_registry}.h`, `libs/tiforth/src/tiforth/{engine,expr,function_registry}.cc`, `libs/tiforth/include/tiforth/operators/{filter,hash_agg,projection}.h`, `libs/tiforth/src/tiforth/operators/{filter,hash_agg,projection}.cc`, `libs/tiforth/tests/*`, `dbms/src/Flash/tests/gtest_tiforth_{block_runner,pipeline_translate,type_mapping}.cpp`, `docs/design/2026-01-14-tiforth-milestone-{3,8}-*.md`, `.codex/progress/daemon.md`. Tests: `ninja -C libs/tiforth/build-debug && ctest --test-dir libs/tiforth/build-debug`; `ninja -C cmake-build-tiflash-tiforth-debug gtests_dbms && ./cmake-build-tiflash-tiforth-debug/dbms/gtests_dbms --gtest_filter=TiForth*`. Notes: only decimal+decimal common path; collation mismatch returns NOT_IMPLEMENTED (no coercibility yet).
- MS1-7: TiForth library/framework + operators + host hooks. Notes: Arrow `RecordBatch` boundary; pipeline/task APIs; Projection/Filter/HashAgg/Sort/HashJoin common path; memory pool + spill hook skeleton; C ABI stubs. Files: `libs/tiforth/include/tiforth/*`, `libs/tiforth/src/tiforth/*`, `libs/tiforth/src/tiforth_capi/*`, `docs/design/2026-01-14-tiforth-milestone-{1..7}-*.md`.
- MS8: TiFlash type->Arrow mapping contract + semantics hooks. Notes: Decimal precision/scale + Decimal128/256; MyDate/MyDateTime packed uint64; strings as Arrow `binary` + collation id metadata; collation-aware compare/hash/sort/group/join keys (BINARY + PAD SPACE BIN). Files: `dbms/src/Flash/TiForth/ArrowTypeMapping.{h,cpp}`, `libs/tiforth/include/tiforth/{type_metadata.h,collation.h}`, `libs/tiforth/src/tiforth/{type_metadata.cc,collation.cc,expr.cc}`, `docs/design/2026-01-14-tiforth-milestone-8-type-mapping.md`.
- MS9-10: TiFlash-first host integration + end-to-end gtests. Notes: Arrow<->Block conversion with metadata roundtrip (collation via side-channel); `RunTiForthPipelineOnBlocks` adapter; gtests covering filter/agg/join with composite keys + decimal/date-time/collated strings; docs synced. Files: `dbms/src/Flash/TiForth/{ArrowBlockConversion,BlockPipelineRunner}.{h,cpp}`, `dbms/src/Flash/tests/gtest_tiforth_*.cpp`, `docs/design/2026-01-14-tiforth-milestone-9-host-integration.md`.
